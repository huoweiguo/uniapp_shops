{"version":3,"file":"uni-data-pickerview.js","sources":["uni_modules/uni-data-picker/components/uni-data-pickerview/uni-data-pickerview.vue","../../安装文件/HBuilderX.4.08.2024040127/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovd29yay91bmlhcHBfc2hvcC91bmlfbW9kdWxlcy91bmktZGF0YS1waWNrZXIvY29tcG9uZW50cy91bmktZGF0YS1waWNrZXJ2aWV3L3VuaS1kYXRhLXBpY2tlcnZpZXcudnVl"],"sourcesContent":["<template>\n  <view class=\"uni-data-pickerview\">\n    <scroll-view v-if=\"!isCloudDataList\" class=\"selected-area\" scroll-x=\"true\">\n      <view class=\"selected-list\">\n          <view \n            class=\"selected-item\"\n            v-for=\"(item,index) in selected\"\n            :key=\"index\"\n            :class=\"{\n              'selected-item-active':index == selectedIndex\n            }\"\n            @click=\"handleSelect(index)\"\n          >\n            <text>{{item.text || ''}}</text>\n          </view>\n      </view>\n    </scroll-view>\n    <view class=\"tab-c\">\n      <scroll-view class=\"list\" :scroll-y=\"true\">\n        <view class=\"item\" :class=\"{'is-disabled': !!item.disable}\" v-for=\"(item, j) in dataList[selectedIndex]\" :key=\"j\"\n          @click=\"handleNodeClick(item, selectedIndex, j)\">\n          <text class=\"item-text\">{{item[map.text]}}</text>\n          <view class=\"check\" v-if=\"selected.length > selectedIndex && item[map.value] == selected[selectedIndex].value\"></view>\n        </view>\n      </scroll-view>\n\n      <view class=\"loading-cover\" v-if=\"loading\">\n        <uni-load-more class=\"load-more\" :contentText=\"loadMore\" status=\"loading\"></uni-load-more>\n      </view>\n      <view class=\"error-message\" v-if=\"errorMessage\">\n        <text class=\"error-text\">{{errorMessage}}</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\n  import dataPicker from \"./uni-data-picker.js\"\n\n  /**\n   * DataPickerview\n   * @description uni-data-pickerview\n   * @tutorial https://ext.dcloud.net.cn/plugin?id=3796\n   * @property {Array} localdata 本地数据，参考\n   * @property {Boolean} step-searh = [true|false] 是否分布查询\n   * @value true 启用分布查询，仅查询当前选中节点\n   * @value false 关闭分布查询，一次查询出所有数据\n   * @property {String|DBFieldString} self-field 分布查询当前字段名称\n   * @property {String|DBFieldString} parent-field 分布查询父字段名称\n   * @property {String|DBCollectionString} collection 表名\n   * @property {String|DBFieldString} field 查询字段，多个字段用 `,` 分割\n   * @property {String} orderby 排序字段及正序倒叙设置\n   * @property {String|JQLString} where 查询条件\n   */\n  export default {\n    name: 'UniDataPickerView',\n    emits: ['nodeclick', 'change', 'datachange', 'update:modelValue'],\n    mixins: [dataPicker],\n    props: {\n      managedMode: {\n        type: Boolean,\n        default: false\n      },\n      ellipsis: {\n        type: Boolean,\n        default: true\n      }\n    },\n    created() {\n      if (!this.managedMode) {\n        this.$nextTick(() => {\n          this.loadData();\n        })\n      }\n    },\n    methods: {\n      onPropsChange() {\n        this._treeData = [];\n        this.selectedIndex = 0;\n        this.$nextTick(() => {\n          this.loadData();\n        })\n      },\n      handleSelect(index) {\n        this.selectedIndex = index;\n      },\n      handleNodeClick(item, i, j) {\n        if (item.disable) {\n          return;\n        }\n\n        const node = this.dataList[i][j];\n        const text = node[this.map.text];\n        const value = node[this.map.value];\n\n        if (i < this.selected.length - 1) {\n          this.selected.splice(i, this.selected.length - i)\n          this.selected.push({\n            text,\n            value\n          })\n        } else if (i === this.selected.length - 1) {\n          this.selected.splice(i, 1, {\n            text,\n            value\n          })\n        }\n\n        if (node.isleaf) {\n          this.onSelectedChange(node, node.isleaf)\n          return\n        }\n\n        const {\n          isleaf,\n          hasNodes\n        } = this._updateBindData()\n\n        // 本地数据\n        if (this.isLocalData) {\n          this.onSelectedChange(node, (!hasNodes || isleaf))\n        } else if (this.isCloudDataList) { // Cloud 数据 (单列)\n          this.onSelectedChange(node, true)\n        } else if (this.isCloudDataTree) { // Cloud 数据 (树形)\n          if (isleaf) {\n            this.onSelectedChange(node, node.isleaf)\n          } else if (!hasNodes) { // 请求一次服务器以确定是否为叶子节点\n            this.loadCloudDataNode((data) => {\n              if (!data.length) {\n                node.isleaf = true\n              } else {\n                this._treeData.push(...data)\n                this._updateBindData(node)\n              }\n              this.onSelectedChange(node, node.isleaf)\n            })\n          }\n        }\n      },\n      updateData(data) {\n        this._treeData = data.treeData\n        this.selected = data.selected\n        if (!this._treeData.length) {\n          this.loadData()\n        } else {\n          //this.selected = data.selected\n          this._updateBindData()\n        }\n      },\n      onDataChange() {\n        this.$emit('datachange');\n      },\n      onSelectedChange(node, isleaf) {\n        if (isleaf) {\n          this._dispatchEvent()\n        }\n\n        if (node) {\n          this.$emit('nodeclick', node)\n        }\n      },\n      _dispatchEvent() {\n        this.$emit('change', this.selected.slice(0))\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\">\n\t$uni-primary: #007aff !default;\n\n\t.uni-data-pickerview {\n\t\tflex: 1;\n\t\t/* #ifndef APP-NVUE */\n\t\tdisplay: flex;\n\t\t/* #endif */\n\t\tflex-direction: column;\n\t\toverflow: hidden;\n\t\theight: 100%;\n\t}\n\n  .error-text {\n    color: #DD524D;\n  }\n\n  .loading-cover {\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    background-color: rgba(255, 255, 255, .5);\n    /* #ifndef APP-NVUE */\n    display: flex;\n    /* #endif */\n    flex-direction: column;\n    align-items: center;\n    z-index: 1001;\n  }\n\n  .load-more {\n    /* #ifndef APP-NVUE */\n    margin: auto;\n    /* #endif */\n  }\n\n  .error-message {\n    background-color: #fff;\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    padding: 15px;\n    opacity: .9;\n    z-index: 102;\n  }\n\n  /* #ifdef APP-NVUE */\n  .selected-area {\n    width: 750rpx;\n  }\n  /* #endif */\n\n  .selected-list {\n    /* #ifndef APP-NVUE */\n    display: flex;\n    flex-wrap: nowrap;\n    /* #endif */\n    flex-direction: row;\n    padding: 0 5px;\n    border-bottom: 1px solid #f8f8f8;\n  }\n\n  .selected-item {\n    margin-left: 10px;\n    margin-right: 10px;\n    padding: 12px 0;\n    text-align: center;\n    /* #ifndef APP-NVUE */\n    white-space: nowrap;\n    /* #endif */\n  }\n\n  .selected-item-text-overflow {\n    width: 168px;\n    /* fix nvue */\n    overflow: hidden;\n    /* #ifndef APP-NVUE */\n    width: 6em;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    -o-text-overflow: ellipsis;\n    /* #endif */\n  }\n\n\t.selected-item-active {\n\t\tborder-bottom: 2px solid $uni-primary;\n\t}\n\n\t.selected-item-text {\n\t\tcolor: $uni-primary;\n\t}\n\n  .tab-c {\n    position: relative;\n    flex: 1;\n    /* #ifndef APP-NVUE */\n    display: flex;\n    /* #endif */\n    flex-direction: row;\n    overflow: hidden;\n  }\n\n  .list {\n    flex: 1;\n  }\n\n  .item {\n    padding: 12px 15px;\n    /* border-bottom: 1px solid #f0f0f0; */\n    /* #ifndef APP-NVUE */\n    display: flex;\n    /* #endif */\n    flex-direction: row;\n    justify-content: space-between;\n  }\n\n  .is-disabled {\n    opacity: .5;\n  }\n\n  .item-text {\n    /* flex: 1; */\n    color: #333333;\n  }\n\n  .item-text-overflow {\n    width: 280px;\n    /* fix nvue */\n    overflow: hidden;\n    /* #ifndef APP-NVUE */\n    width: 20em;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    -o-text-overflow: ellipsis;\n    /* #endif */\n  }\n\n\t.check {\n\t\tmargin-right: 5px;\n\t\tborder: 2px solid $uni-primary;\n\t\tborder-left: 0;\n\t\tborder-top: 0;\n\t\theight: 12px;\n\t\twidth: 6px;\n\t\ttransform-origin: center;\n\t\t/* #ifndef APP-NVUE */\n\t\ttransition: all 0.3s;\n\t\t/* #endif */\n\t\ttransform: rotate(45deg);\n\t}\n</style>\n","import Component from 'D:/work/uniapp_shop/uni_modules/uni-data-picker/components/uni-data-pickerview/uni-data-pickerview.vue'\nwx.createComponent(Component)"],"names":["dataPicker"],"mappings":";;;AAsDE,MAAK,YAAU;AAAA,EACb,MAAM;AAAA,EACN,OAAO,CAAC,aAAa,UAAU,cAAc,mBAAmB;AAAA,EAChE,QAAQ,CAACA,qEAAAA,UAAU;AAAA,EACnB,OAAO;AAAA,IACL,aAAa;AAAA,MACX,MAAM;AAAA,MACN,SAAS;AAAA,IACV;AAAA,IACD,UAAU;AAAA,MACR,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,EACD;AAAA,EACD,UAAU;AACR,QAAI,CAAC,KAAK,aAAa;AACrB,WAAK,UAAU,MAAM;AACnB,aAAK,SAAQ;AAAA,OACd;AAAA,IACH;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,gBAAgB;AACd,WAAK,YAAY;AACjB,WAAK,gBAAgB;AACrB,WAAK,UAAU,MAAM;AACnB,aAAK,SAAQ;AAAA,OACd;AAAA,IACF;AAAA,IACD,aAAa,OAAO;AAClB,WAAK,gBAAgB;AAAA,IACtB;AAAA,IACD,gBAAgB,MAAM,GAAG,GAAG;AAC1B,UAAI,KAAK,SAAS;AAChB;AAAA,MACF;AAEA,YAAM,OAAO,KAAK,SAAS,CAAC,EAAE,CAAC;AAC/B,YAAM,OAAO,KAAK,KAAK,IAAI,IAAI;AAC/B,YAAM,QAAQ,KAAK,KAAK,IAAI,KAAK;AAEjC,UAAI,IAAI,KAAK,SAAS,SAAS,GAAG;AAChC,aAAK,SAAS,OAAO,GAAG,KAAK,SAAS,SAAS,CAAC;AAChD,aAAK,SAAS,KAAK;AAAA,UACjB;AAAA,UACA;AAAA,SACD;AAAA,MACH,WAAW,MAAM,KAAK,SAAS,SAAS,GAAG;AACzC,aAAK,SAAS,OAAO,GAAG,GAAG;AAAA,UACzB;AAAA,UACA;AAAA,SACD;AAAA,MACH;AAEA,UAAI,KAAK,QAAQ;AACf,aAAK,iBAAiB,MAAM,KAAK,MAAM;AACvC;AAAA,MACF;AAEA,YAAM;AAAA,QACJ;AAAA,QACA;AAAA,UACE,KAAK,gBAAgB;AAGzB,UAAI,KAAK,aAAa;AACpB,aAAK,iBAAiB,MAAO,CAAC,YAAY,MAAO;AAAA,MACnD,WAAW,KAAK,iBAAiB;AAC/B,aAAK,iBAAiB,MAAM,IAAI;AAAA,MAClC,WAAW,KAAK,iBAAiB;AAC/B,YAAI,QAAQ;AACV,eAAK,iBAAiB,MAAM,KAAK,MAAM;AAAA,QACzC,WAAW,CAAC,UAAU;AACpB,eAAK,kBAAkB,CAAC,SAAS;AAC/B,gBAAI,CAAC,KAAK,QAAQ;AAChB,mBAAK,SAAS;AAAA,mBACT;AACL,mBAAK,UAAU,KAAK,GAAG,IAAI;AAC3B,mBAAK,gBAAgB,IAAI;AAAA,YAC3B;AACA,iBAAK,iBAAiB,MAAM,KAAK,MAAM;AAAA,WACxC;AAAA,QACH;AAAA,MACF;AAAA,IACD;AAAA,IACD,WAAW,MAAM;AACf,WAAK,YAAY,KAAK;AACtB,WAAK,WAAW,KAAK;AACrB,UAAI,CAAC,KAAK,UAAU,QAAQ;AAC1B,aAAK,SAAS;AAAA,aACT;AAEL,aAAK,gBAAgB;AAAA,MACvB;AAAA,IACD;AAAA,IACD,eAAe;AACb,WAAK,MAAM,YAAY;AAAA,IACxB;AAAA,IACD,iBAAiB,MAAM,QAAQ;AAC7B,UAAI,QAAQ;AACV,aAAK,eAAe;AAAA,MACtB;AAEA,UAAI,MAAM;AACR,aAAK,MAAM,aAAa,IAAI;AAAA,MAC9B;AAAA,IACD;AAAA,IACD,iBAAiB;AACf,WAAK,MAAM,UAAU,KAAK,SAAS,MAAM,CAAC,CAAC;AAAA,IAC7C;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpKF,GAAG,gBAAgB,SAAS;"}